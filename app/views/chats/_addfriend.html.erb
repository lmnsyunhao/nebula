<div class="modal fade" id="basicExampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add A Friend</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form class="form-incline" id="search-friend">
          <div class="md-form input-group">
            <%= text_field_tag :query, params[:query], placeholder: "Enter user name", class: 'form-control' %>
            <div class="input-group-append">
              <button type="submit" class="btn btn-md btn-secondary m-0 px-3 waves-effect waves-light" type="button" id="MaterialButton-addon2">Search</button>
            </div>
          </div>

        </form>
      </div>
      <table class="table table-hover" id="result">
        <thead>
        </thead>
        <tbody>
        </tbody>
      </table>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<script>
  $('#search-friend').submit(function () {
    var valuesToSubmit = $(this).serialize();
    $.ajax({
      type: 'GET',
      url: '/users/index_json',
      dataType: "JSON",
      data: valuesToSubmit,
      success: function (data) {
        $('#result tr').remove();
        $('#result text').remove();

        if (data != "") {
          $('#result thead').html("<tr><th>姓名</th><th>性别</th><th>联系方式</th><th></th></tr>");
          $.each(data, function (index, user) {
            $('#result tbody').append("<tr><td>" + user.name + "</td><td>" + user.sex + "</td><td>" + user.email + "</td><td><a class='btn btn-success btn-xs' data-method='post' href='/friendships?friend_id=" + user.id + "'>添加</a></td></tr>");
          });
        } else {
          $('#result tbody').append("<text>没有找到符合条件的用户</text>")
        }

      }, error: function () {
        alert('error in post');
      }
    });
    return false;
  });

</script>